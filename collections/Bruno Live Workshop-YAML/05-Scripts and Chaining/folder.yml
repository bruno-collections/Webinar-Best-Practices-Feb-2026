info:
  name: 05-Scripts and Chaining
  type: folder
  seq: 5

request: {}

docs:
  content: |-
    # âš¡ Section 4: Scripts and Chaining

    Scripts let you run JavaScript **before** and **after** requests â€” enabling powerful automation workflows.

    In this section, you will:

    - âœ… Write pre-request scripts to generate dynamic data
    - âœ… Write post-response scripts to capture data from responses
    - âœ… Chain requests together using runtime variables

    ---

    ### âš¡ Step 1: Create "Pre-Request Scripting"

    1. Right-click on the `04-Scripts and Chaining` folder â†’ **New Request**
    2. Name it `Pre-Request Scripting`
    3. Set the method to **POST**
    4. Set the URL to: `{{echoUrl}}`
    5. Go to **Body** â†’ **JSON** and paste:

    ```json
    {
      "generatedAt": "{{timestamp}}",
      "daysAgo": "{{pastDate}}",
      "requestId": "{{requestId}}"
    }
    ```

    6. Go to the **Script** tab â†’ **Pre Request** and paste:

    ```javascript
    const now = new Date();
    bru.setVar("timestamp", now.toISOString());

    const past = new Date(now);
    past.setDate(past.getDate() - 7);
    bru.setVar("pastDate", past.toISOString().split("T")[0]);

    const id = `req_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;
    bru.setVar("requestId", id);

    console.log("ğŸ“ Generated request ID:", id);
    ```

    7. Click **Send** â–¶ï¸ â€” the echo server returns the generated values!
    8. Check the **Timeline** tab to see the `console.log()` output

    ---

    ### ğŸ”— Step 2: Create "Capture and Reuse"

    This request creates a post and **captures the returned ID** for the next request.

    1. Create a new request named `Capture and Reuse`
    2. Set the method to **POST**
    3. Set the URL to: `{{baseUrl}}/posts`
    4. Go to **Body** â†’ **JSON** and paste:

    ```json
    {
      "title": "Created by Bruno",
      "body": "This post was created during the workshop to demonstrate variable chaining.",
      "userId": {{defaultUserId}}
    }
    ```

    5. Go to the **Script** tab â†’ **Post Response** and paste:

    ```javascript
    const body = res.getBody();

    if (body && body.id) {
      bru.setVar("capturedPostId", body.id);
      bru.setVar("capturedPostTitle", body.title);
      console.log("âœ… Captured post ID:", body.id);
    }
    ```

    6. Go to the **Tests** tab and paste:

    ```javascript
    test("Post was created successfully", () => {
      expect(res.status).to.equal(201);
      expect(res.getBody()).to.have.property("id");
    });
    ```

    7. Click **Send** â–¶ï¸ â€” you should get **201 Created** and the post ID is now stored!

    ---

    ### ğŸ”— Step 3: Create "Use Captured Data"

    âš ï¸ **Run Step 2 first!** This request depends on the captured post ID.

    1. Create a new request named `Use Captured Data`
    2. Set the method to **GET**
    3. Set the URL to: `{{baseUrl}}/posts/{{capturedPostId}}`
    4. Go to the **Script** tab â†’ **Pre Request** and paste:

    ```javascript
    const postId = bru.getVar("capturedPostId");

    if (!postId) {
      console.warn("âš ï¸ No captured post ID found! Run 'Capture and Reuse' first.");
    } else {
      console.log("ğŸ”— Using captured post ID:", postId);
    }
    ```

    5. Go to the **Tests** tab and paste:

    ```javascript
    test("Retrieved a valid post", () => {
      const body = res.getBody();
      expect(body).to.have.property("id");
      expect(body).to.have.property("title");
      expect(body).to.have.property("body");
    });
    ```

    6. Click **Send** â–¶ï¸ â€” it uses the ID from Step 2 to fetch the post!

    ---

    ### ğŸ“Œ Summary

    In this section, you learned how to:

    - âœ… Use pre-request scripts to generate dynamic data with `bru.setVar()`
    - âœ… Use post-response scripts to capture response data
    - âœ… Chain requests using runtime variables (`bru.setVar()` / `bru.getVar()`)

    ğŸ“ Check the **Solution** folder to see the completed requests.
  type: text/markdown
