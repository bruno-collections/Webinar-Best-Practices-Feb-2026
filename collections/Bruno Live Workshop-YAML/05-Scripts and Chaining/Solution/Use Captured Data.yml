info:
  name: Transform Array Data
  type: http
  seq: 3

http:
  method: GET
  url: "{{baseUrl}}/posts?userId={{defaultUserId}}"

runtime:
  scripts:
    - type: after-response
      code: |-
        const posts = res.getBody();

        if (Array.isArray(posts) && posts.length > 0) {
          // Count total posts
          bru.setVar("totalPosts", posts.length);

          // Extract all post IDs
          const postIds = posts.map(post => post.id);
          bru.setVar("allPostIds", JSON.stringify(postIds));

          // Get first and last post IDs
          bru.setVar("firstPostId", posts[0].id);
          bru.setVar("lastPostId", posts[posts.length - 1].id);

          // Calculate average title length
          const avgTitleLength = Math.round(
            posts.reduce((sum, post) => sum + post.title.length, 0) / posts.length
          );
          bru.setVar("avgTitleLength", avgTitleLength);

          // Find longest post title
          const longestPost = posts.reduce((longest, post) =>
            post.title.length > longest.title.length ? post : longest
          );
          bru.setVar("longestPostTitle", longestPost.title);

          console.log("ðŸ“Š Array Analysis:");
          console.log("   Total posts:", posts.length);
          console.log("   Avg title length:", avgTitleLength);
          console.log("   Longest title:", longestPost.title);
        }
    - type: tests
      code: |-
        test("Posts array is valid", () => {
          const posts = res.getBody();
          expect(posts).to.be.an("array");
          expect(posts.length).to.be.greaterThan(0);
          expect(posts[0]).to.have.property("title");
        });
  assertions:
    - expression: res.status
      operator: eq
      value: "200"
    - expression: res.body
      operator: isArray

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5

docs: |-
  # Transform Array Data ðŸ“Š

  This request demonstrates how to **process arrays and calculate aggregate values** from API responses.

  **What this script does:**
  1. Counts total number of posts
  2. Extracts all post IDs into an array using `map()`
  3. Gets first and last post IDs
  4. Calculates average title length using `reduce()`
  5. Finds the post with the longest title

  **Key techniques:**
  - Array methods: `map()`, `reduce()`, `filter()`
  - Aggregate calculations (count, average, min/max)
  - Storing both individual values and JSON arrays

  Check the **Timeline** tab to see the analysis results!
