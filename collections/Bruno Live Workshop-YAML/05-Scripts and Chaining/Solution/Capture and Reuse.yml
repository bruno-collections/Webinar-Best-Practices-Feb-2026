info:
  name: Capture and Reuse
  type: http
  seq: 2

http:
  method: POST
  url: "{{baseUrl}}/posts"
  body:
    type: json
    data: |-
      {
        "title": "Created by Bruno",
        "body": "This post was created during the workshop to demonstrate variable chaining.",
        "userId": {{defaultUserId}}
      }

runtime:
  scripts:
    - type: after-response
      code: |-
        // Capture the ID returned by the API
        const body = res.getBody();

        if (body && body.id) {
          bru.setVar("capturedPostId", body.id);
          bru.setVar("capturedPostTitle", body.title);
          console.log("âœ… Captured post ID:", body.id);
          console.log("âœ… Captured title:", body.title);
        }
    - type: tests
      code: |-
        test("Post was created successfully", () => {
          expect(res.status).to.equal(201);
          expect(res.getBody()).to.have.property("id");
        });
  assertions:
    - expression: res.status
      operator: eq
      value: "201"
    - expression: res.body.id
      operator: isNumber
    - expression: res.body.title
      operator: eq
      value: Created by Bruno

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5

docs: |-
  # Capture and Reuse ðŸ”—

  This request creates a new post and **captures the returned ID** using a post-response script.

  **The key line:**
  ```javascript
  bru.setVar("capturedPostId", body.id);
  ```

  This stores the post ID as a **runtime variable** that persists across requests in this session.

  **Send this request first**, then open **Use Captured Data** to see the chaining in action!
