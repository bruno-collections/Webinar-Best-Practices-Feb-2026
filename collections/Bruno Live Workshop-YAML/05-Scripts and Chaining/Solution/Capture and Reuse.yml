info:
  name: Parse Nested Data
  type: http
  seq: 2

http:
  method: GET
  url: "{{baseUrl}}/users/{{defaultUserId}}"

runtime:
  scripts:
    - type: after-response
      code: |-
        const user = res.getBody();

        // Extract and transform nested data
        if (user) {
          // Store basic user info
          bru.setVar("userId", user.id);
          bru.setVar("userName", user.name);
          bru.setVar("userEmail", user.email);

          // Parse and extract address components
          if (user.address) {
            const fullAddress = `${user.address.street}, ${user.address.city}`;
            bru.setVar("userAddress", fullAddress);
            bru.setVar("userCity", user.address.city);

            // Extract coordinates
            if (user.address.geo) {
              bru.setVar("userLat", user.address.geo.lat);
              bru.setVar("userLng", user.address.geo.lng);
            }
          }

          // Parse company info
          if (user.company) {
            bru.setVar("companyName", user.company.name);
          }

          console.log("‚úÖ Extracted user data:");
          console.log("   Name:", user.name);
          console.log("   City:", user.address?.city);
          console.log("   Company:", user.company?.name);
        }
    - type: tests
      code: |-
        test("User data is complete", () => {
          const user = res.getBody();
          expect(user).to.have.property("id");
          expect(user).to.have.property("address");
          expect(user.address).to.have.property("geo");
        });
  assertions:
    - expression: res.status
      operator: eq
      value: "200"
    - expression: res.body.id
      operator: isNumber
    - expression: res.body.address
      operator: isDefined

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5

docs: |-
  # Parse Nested Data üîç

  This request demonstrates how to **extract and transform complex nested JSON** from API responses.

  **What this script does:**
  1. Extracts basic user properties (id, name, email)
  2. Parses nested address object and creates a formatted address string
  3. Extracts geo coordinates from deeply nested structure
  4. Stores company information

  **Key techniques:**
  - Using optional chaining (`user.address?.city`) to safely access nested properties
  - Combining multiple fields into formatted strings
  - Storing multiple variables from a single response

  Check the **Timeline** tab to see all the extracted values!
