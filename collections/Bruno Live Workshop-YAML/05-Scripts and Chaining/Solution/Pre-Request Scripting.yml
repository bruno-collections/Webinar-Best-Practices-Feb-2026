info:
  name: Pre-Request Scripting
  type: http
  seq: 1

http:
  method: POST
  url: "{{echoUrl}}"
  body:
    type: json
    data: |-
      {
        "generatedAt": "{{timestamp}}",
        "daysAgo": "{{pastDate}}",
        "requestId": "{{requestId}}"
      }

runtime:
  scripts:
    - type: before-request
      code: |-
        // Generate a timestamp
        const now = new Date();
        bru.setVar("timestamp", now.toISOString());

        // Calculate a date 7 days ago
        const past = new Date(now);
        past.setDate(past.getDate() - 7);
        bru.setVar("pastDate", past.toISOString().split("T")[0]);

        // Generate a unique request ID
        const id = `req_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;
        bru.setVar("requestId", id);

        console.log("üìù Generated request ID:", id);
        console.log("üìÖ Past date:", past.toISOString().split("T")[0]);
  assertions:
    - expression: res.status
      operator: eq
      value: "200"

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5

docs: |-
  # Pre-Request Scripting ‚ö°

  The `script:pre-request {}` block runs JavaScript **before** the request is sent.

  **This script:**
  1. Generates a current ISO timestamp
  2. Calculates a date 7 days in the past
  3. Creates a unique request ID
  4. Stores all values with `bru.setVar()` for use in the request body

  **Send the request** and see the echo response ‚Äî all the generated values will appear in the body!

  Check the **Timeline** tab to see the `console.log()` output.
