meta {
  name: Pre-Request Scripting
  type: http
  seq: 1
}

post {
  url: {{echoUrl}}
  body: json
  auth: none
}

body:json {
  {
    "generatedAt": "{{timestamp}}",
    "daysAgo": "{{pastDate}}",
    "requestId": "{{requestId}}"
  }
}

assert {
  res.status: eq 200
}

script:pre-request {
  // Generate a timestamp
  const now = new Date();
  bru.setVar("timestamp", now.toISOString());
  
  // Calculate a date 7 days ago
  const past = new Date(now);
  past.setDate(past.getDate() - 7);
  bru.setVar("pastDate", past.toISOString().split("T")[0]);
  
  // Generate a unique request ID
  const id = `req_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;
  bru.setVar("requestId", id);
  
  console.log("ğŸ“ Generated request ID:", id);
  console.log("ğŸ“… Past date:", past.toISOString().split("T")[0]);
}

docs {
  # Pre-Request Scripting âš¡
  
  The `script:pre-request {}` block runs JavaScript **before** the request is sent.
  
  **This script:**
  1. Generates a current ISO timestamp
  2. Calculates a date 7 days in the past
  3. Creates a unique request ID
  4. Stores all values with `bru.setVar()` for use in the request body
  
  **Send the request** and see the echo response â€” all the generated values will appear in the body!
  
  Check the **Timeline** tab to see the `console.log()` output.
}
