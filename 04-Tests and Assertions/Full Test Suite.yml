info:
  name: Full Test Suite
  type: http
  seq: 3

http:
  method: GET
  url: "{{baseUrl}}/users"

runtime:
  scripts:
    - type: tests
      code: |-
        // Use the zod package
        const { z } = require("");
        const body = res.getBody();

        // --- Standard Chai.js Tests ---

        test("Returns 200 OK", () => {
          expect(res.status).to.equal(200);
        });

        test("Response is an array of users", () => {
          expect(body).to.be.an("array");
          expect(body.length).to.be.greaterThan(0);
        });

        test("Each user has core fields", () => {
          body.forEach((user, i) => {
            expect(user, `User ${i}`).to.have.property("id");
            expect(user, `User ${i}`).to.have.property("name");
            expect(user, `User ${i}`).to.have.property("email");
          });
        });

        // --- Zod Schema Validation (External Library) ---

        const UserSchema = z.object({
          id: z.number().int().positive(),
          name: z.string().min(1),
          username: z.string().min(1),
          email: z.string().email(),
          phone: z.string(),
          website: z.string(),
          address: z.object({
            street: z.string(),
            city: z.string(),
            zipcode: z.string()
          }).passthrough(),
          company: z.object({
            name: z.string()
          }).passthrough()
        });

        test("First user matches Zod schema", () => {
          const result = UserSchema.safeParse(body[0]);
          expect(result.success).to.be.true;
        });

        test("All users pass Zod schema validation", () => {
          body.forEach((user, i) => {
            const result = UserSchema.safeParse(user);
            expect(
              result.success,
              `User ${i} (${user.name}) failed validation`
            ).to.be.true;
          });
        });
  assertions:
    - expression: res.status
      operator: eq
      value: "200"
    - expression: res.body[0]
      operator: isJson
    - expression: res.body
      operator: isArray

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5

docs: |-
  # Full Test Suite üèÜ

  This request combines everything:
  - **Assert block** for quick declarative checks
  - **Chai.js tests** for expressive JavaScript assertions
  - **Zod schema validation** using an external npm library

  ## üîå External Libraries
  Bruno supports loading npm packages! This collection includes a `package.json` with **Zod** ‚Äî a TypeScript-first schema validation library.

  ```javascript
  const { z } = require("zod");
  const UserSchema = z.object({
    id: z.number().int().positive(),
    name: z.string().min(1),
    email: z.string().email()
  });
  ```

  **Note:** Run `npm install` in the collection root directory to install Zod before running this request.

  This pattern is powerful for **contract testing** ‚Äî ensuring API responses always match your expected schema.
